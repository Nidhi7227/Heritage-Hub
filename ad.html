<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HeritageHub Admin Analytics</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background-color: #f8f9fa; }
    .stat-card { padding: 20px; border-radius: 10px; font-size: 18px; font-weight: bold; text-align: center; color: white; margin-bottom: 20px; }
    .total-users { background-color: #28a745; }
    .total-contribs { background-color: #007bff; }
    #logoutBtn { position: absolute; top: 20px; right: 20px; }
  </style>
</head>

<body>
  <div class="container my-5">
    <button id="logoutBtn" class="btn btn-danger">
      <i class="fas fa-sign-out-alt me-2"></i> Logout
    </button>

    <h2 class="mb-4">HeritageHub Admin Analytics Dashboard</h2>

    <div class="row">
      <div class="col-md-6">
        <div class="stat-card total-users">
          <i class="fas fa-users me-2"></i> Total Users: <span id="totalUsers">0</span>
        </div>
      </div>
      <div class="col-md-6">
        <div class="stat-card total-contribs">
          <i class="fas fa-book me-2"></i> Total Contributions: <span id="totalContribs">0</span>
        </div>
      </div>
    </div>

    <canvas id="analyticsChart" height="100"></canvas>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCDZvBUNUEKEXU5_YeQtgUc-dkMQxbFnTg",
      authDomain: "heritagehub-ede14.firebaseapp.com",
      projectId: "heritagehub-ede14",
      storageBucket: "heritagehub-ede14.appspot.com",
      messagingSenderId: "517516088585",
      appId: "1:517516088585:web:7fc9b19f424e0081a2afd8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        alert("Please login to view dashboard.");
        window.location.href = "login.html";
        return;
      }

      const usersSnap = await getDocs(collection(db, 'users'));
      const contributionsSnap = await getDocs(collection(db, 'contributions'));

      const totalUsers = usersSnap.size;
      const totalContribs = contributionsSnap.size;

      document.getElementById('totalUsers').innerText = totalUsers;
      document.getElementById('totalContribs').innerText = totalContribs;

      const statusCounts = { accepted: 0, pending: 0, rejected: 0 };

      contributionsSnap.forEach(doc => {
        const data = doc.data();
        const status = data.status || 'pending';
        if (statusCounts[status] !== undefined) {
          statusCounts[status]++;
        }
      });

      const ctx = document.getElementById('analyticsChart').getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Accepted', 'Pending', 'Rejected'],
          datasets: [{
            label: 'Contributions Status',
            data: [statusCounts.accepted, statusCounts.pending, statusCounts.rejected],
            backgroundColor: ['#28a745', '#ffc107', '#dc3545']
          }]
        },
        options: { responsive: true }
      });
    });

    document.getElementById("logoutBtn").addEventListener("click", () => {
      auth.signOut().then(() => {
        window.location.href = "login.html";
      }).catch((error) => {
        console.error("Error signing out:", error);
      });
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

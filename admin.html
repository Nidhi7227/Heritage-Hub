<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - HeritageHub</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
</head>
<body class="p-4">
  <h1 class="mb-4">Admin Dashboard</h1>
  <div id="storyList" class="table-responsive"></div>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

  <script>
    // ✅ Replace with your Firebase config
    var firebaseConfig = {
       
    apiKey: "AIzaSyCDZvBUNUEKEXU5_YeQtgUc-dkMQxbFnTg",
    authDomain: "heritagehub-ede14.firebaseapp.com",
    projectId: "heritagehub-ede14",
    storageBucket: "heritagehub-ede14.appspot.com",
    messagingSenderId: "517516088585",
    appId: "1:517516088585:web:7fc9b19f424e0081a2afd8"
  };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ✅ Init EmailJS
    (function(){
      emailjs.init("q6rDqik08Ut284_bI"); 
    })();

    // Fetch & display stories
    function loadStories(){
      db.collection("stories").get().then(snapshot=>{
        let html = `
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Name</th><th>Email</th><th>Title</th><th>Story</th><th>Image</th><th>Status</th><th>Action</th>
              </tr>
            </thead><tbody>
        `;
        snapshot.forEach(doc=>{
          const d = doc.data();
          html += `
            <tr>
              <td>${d.name || ""}</td>
              <td>${d.email || ""}</td>
              <td>${d.title || ""}</td>
              <td>${d.story || ""}</td>
              <td>${d.imageUrl ? `<img src="${d.imageUrl}" width="80">` : "No Image"}</td>
              <td>${d.status || "Pending"}</td>
              <td>
                <button class="btn btn-success btn-sm" onclick="updateStatus('${doc.id}','Approved','${d.email}','${d.name}','${d.title}')">Approve</button>
                <button class="btn btn-danger btn-sm" onclick="updateStatus('${doc.id}','Rejected','${d.email}','${d.name}','${d.title}')">Reject</button>
              </td>
            </tr>
          `;
        });
        html += `</tbody></table>`;
        document.getElementById("storyList").innerHTML = html;
      });
    }

    // Update status + email contributor
    function updateStatus(id,status,email,name,title){
      db.collection("stories").doc(id).update({ status }).then(()=>{
        alert("Status updated to " + status);

        if(email){
          const params = {
            to_name: name,
            to_email: email,
            story_title: title,
            status: status
          };
          emailjs.send("service_ilwca7s","template_cm4jnm6",params)
            .then(()=>{ console.log("Email sent to", email); })
            .catch(err=>{ console.error("EmailJS Error:", err); });
        }
        loadStories();
      });
    }

    loadStories();
  </script>
</body>
</html>
